<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>토스페이먼츠 결제</title>
    <!-- 토스페이먼츠 SDK 추가 -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<body>
    <button class="button" style="margin-top: 30px" onclick="requestPayment()">결제하기</button>

    <script th:inline="javascript">
        // 서버에서 전달받은 데이터
        const clientKey = [[${clientKey}]];
        const orderId = [[${orderId}]];
        const amount = [[${amount}]];
        const orderName = [[${orderName}]];
        
        const tossPayments = TossPayments(clientKey);
        // 비회원 결제
        const payment = tossPayments.payment({customerKey: TossPayments.ANONYMOUS})
        
        // ------ '결제하기' 버튼 누르면 결제창 띄우기 ------
        async function requestPayment() {
            // 결제를 요청하기 전에 orderId, amount를 서버에 저장하세요.
            // 결제 과정에서 악의적으로 결제 금액이 바뀌는 것을 확인하는 용도입니다.
            await payment.requestPayment({
                method: "CARD", // 카드 결제
                amount: {
                    currency: "KRW",
                    value: amount,
                },
                orderId: orderId, // 고유 주문번호
                orderName: orderName,
                successUrl: window.location.origin + "/payment/success", // 결제 요청이 성공하면 리다이렉트되는 URL
                failUrl: window.location.origin + "/payment/fail", // 결제 요청이 실패하면 리다이렉트되는 URL
                customerEmail: "customer@ikea.com",
                customerName: "IKEA 고객",
                // 카드 결제에 필요한 정보
                card: {
                    useEscrow: false,
                    flowMode: "DEFAULT", // 통합결제창 여는 옵션
                    useCardPoint: false,
                    useAppCardOnly: false,
                },
            });
        }

    </script>
</body>
</html>